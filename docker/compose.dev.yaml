networks:
  my_app-network:
    driver: bridge

volumes:
  node_modules:
  cli_node_modules:
  utils_node_modules:
  config_node_modules:

services:
  context-debug:
    build:
      context: ../
      dockerfile: docker/Dockerfile.debug
    volumes:
      - ./context-report:/out
    restart: "no" # Run once to generate reports, then exit
    profiles:
      - debug

  dev:
    build:
      context: ../
      dockerfile: docker/Dockerfile.dev
      target: dev
    image: my_app/dev:latest
    container_name: my_app-dev
    # Run as host user to avoid permission issues
    # For example (without this), if `dist` is created by the container,
    # the host user may not have permission to read/write it
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ..:/app  # Mount project root to /app
      # Use named volume for node_modules
      - node_modules:/app/node_modules
      - cli_node_modules:/app/apps/cli/node_modules
      - utils_node_modules:/app/packages/utils/node_modules
      - config_node_modules:/app/packages/config/node_modules
    command: pnpm dev
    environment:
      - NODE_ENV=development
    networks:
      - my_app-network
    profiles:
      - dev
