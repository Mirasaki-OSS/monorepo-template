networks:
  my_app-network:
    driver: bridge

volumes:
  node_modules:

services:
  context-debug:
    build:
      context: ../
      dockerfile: docker/Dockerfile.debug
    volumes:
      - ./context-report:/out
    restart: "no" # Run once to generate reports, then exit
    profiles:
      - debug

  dev:
    build:
      context: ../
      dockerfile: docker/Dockerfile.dev
      target: dev
    image: my_app/dev:latest
    container_name: my_app-dev
    volumes:
      - ..:/app  # Mount project root to /app
      - node_modules:/app/node_modules  # Use named volume for root node_modules
      - /app/apps/cli/node_modules  # Anonymous volumes for workspace node_modules
      - /app/packages/utils/node_modules
      - /app/packages/config/node_modules
    command: pnpm dev
    environment:
      - NODE_ENV=development
    networks:
      - my_app-network
    profiles:
      - dev
